<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script type="text/javascript"
  src="https://www.google.com/jsapi?autoload={
    'modules':[{
      'name':'visualization',
      'version':'1',
      'packages':['corechart']
    }]
  }"></script>
</head>

<body>
  <div id="chart" style="width: 900px; height: 500px"></div>

  <script type="text/javascript">
  google.setOnLoadCallback(drawChart);

  var maxDataPoints = 10;
  var chart = new google.visualization.LineChart($('#chart')[0]);
  
  var data = google.visualization.arrayToDataTable([
    ['Time', 'Temperature'],
    [getTime(), 0]
    ]);

  var options = {
    title: 'Temperature',
    curveType: 'function',
    animation: {
      duration: 1000,
      easing: 'in'
    },
    legend: { position: 'bottom' }
  };

  function drawChart() {
    if (data.getNumberOfRows() > maxDataPoints) {
      data.removeRow(0);
    }
    chart.draw(data, options);
  }

  function addDataPoint(dataPoint) {
    data.addRow([getTime(), dataPoint.value]);
    drawChart();
  }

  function getTime() {
    var d = new Date();
    return d.toLocaleTimeString();
  }

  function doPoll(){
    $.getJSON('http://localhost:3000/pi/sensors/temperature', function(result) {
      console.log(result);
      addDataPoint(result);
      setTimeout(doPoll,5000);
    });
  }
  doPoll();
  </script>

</body>
</html>